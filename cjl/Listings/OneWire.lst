C51 COMPILER V9.60.7.0   ONEWIRE                                                           11/21/2023 20:57:55 PAGE 1   


C51 COMPILER V9.60.7.0, COMPILATION OF MODULE ONEWIRE
OBJECT MODULE PLACED IN .\Objects\OneWire.obj
COMPILER INVOKED BY: D:\keil\C51\BIN\C51.EXE OneWire.c OPTIMIZE(8,SPEED) BROWSE INCDIR(D:\Keil\C51\INC\Atmel) DEBUG OBJE
                    -CTEXTEND PRINT(.\Listings\OneWire.lst) OBJECT(.\Objects\OneWire.obj)

line level    source

   1          #include "Tools.h"
   2          #include "reg52.h" 
   3          #include "intrins.h" //_nop_()在此头文件中 #define DQ P14
   4          sbit DQ = P1^4;
   5          // 读和写切换时要记得复位一次
   6          
   7          void reset_onewire_bus()
   8          {
   9   1              DQ = 1;
  10   1              Delayus(5);
  11   1              DQ = 0;
  12   1              Delayus(500);
  13   1              DQ = 1;
  14   1      }
  15          
  16          bit onewire_ack()
  17          {
  18   1              bit ack = 0;
  19   1              Delayus(69);
  20   1              ack = DQ;// 0为有一线设备
  21   1              Delayus(500);
  22   1              return ack;
  23   1      }
  24          
  25          void Write_DS18B20_byte(unsigned char dat)
  26          {
  27   1              unsigned char i;
  28   1              for(i = 0; i < 8; i ++)
  29   1              {
  30   2                      DQ = 0;
  31   2                      Delayus(5);
  32   2                      DQ = dat&0X01;
  33   2                      Delayus(60);
  34   2                      dat >>= 1;
  35   2                      DQ = 1;
  36   2              }
  37   1              
  38   1      }
  39          
  40          
  41          
  42          unsigned char Read_DS18B20_byte()
  43          {
  44   1              unsigned char i, received_byte;
  45   1              for(i = 0; i < 8; i ++)
  46   1              {
  47   2                      DQ = 0;
  48   2                      Delayus(5);
  49   2                      DQ = 1;
  50   2                      Delayus(5);
  51   2                      received_byte >>= 1;
  52   2                      if(DQ == 1)
  53   2                      {
  54   3                              received_byte |= 0X80; // DQ 从低位到高位输出
C51 COMPILER V9.60.7.0   ONEWIRE                                                           11/21/2023 20:57:55 PAGE 2   

  55   3                      }
  56   2                      Delayus(120);
  57   2                      DQ = 1;
  58   2                      Delayus(5);
  59   2              }
  60   1              return received_byte;
  61   1      }
  62          
  63          void init_DS18B20()
  64          {
  65   1              reset_onewire_bus();
  66   1              onewire_ack();
  67   1      }
  68          
  69          float read_temperature()
  70          {
  71   1              unsigned char temh, teml;
  72   1              float temperature;
  73   1              init_DS18B20();
  74   1              Write_DS18B20_byte(0XCC);// 跳过ROM匹配指令
  75   1              Write_DS18B20_byte(0X44);// 启动温度转化指令
  76   1              Delayms(750);// 等待温度转化完成
  77   1              init_DS18B20();
  78   1              Write_DS18B20_byte(0XCC);
  79   1              Write_DS18B20_byte(0XBE);// 写读指令
  80   1              teml = Read_DS18B20_byte();
  81   1              temh = Read_DS18B20_byte();
  82   1              temperature=(int)(temh<<8|teml) * 0.0625;
  83   1              return temperature;
  84   1              
  85   1      }


MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =    214    ----
   CONSTANT SIZE    =   ----    ----
   XDATA SIZE       =   ----    ----
   PDATA SIZE       =   ----    ----
   DATA SIZE        =   ----       5
   IDATA SIZE       =   ----    ----
   BIT SIZE         =   ----       1
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  0 WARNING(S),  0 ERROR(S)
